<!DOCTYPE html>
<html>
<head>
    <title>Queen Puzzle Game</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/vue/3.3.4/vue.global.min.js"></script>
    <style>
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            background-color: #f0f0f0;
            font-family: Arial, sans-serif;
        }
        
        .board {
            display: inline-grid;
            gap: 1px;
            background: #333;
            padding: 1px;
            margin: 20px;
        }
        
        .cell {
            width: 60px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            cursor: pointer;
            user-select: none;
        }
        
        .cell:hover {
            opacity: 0.8;
        }
        
        .mark-x {
            font-weight: bold;
        }
        
        .mark-queen {
            width: 40px;
            height: 40px;
            object-fit: contain;
        }
        
        .controls {
            text-align: center;
            margin-bottom: 1rem;
        }
        
        button {
            font-size: 1rem;
            padding: 0.5rem 1rem;
            margin: 0.5rem;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        
        button:hover {
            background-color: #45a049;
        }

        /* Modal styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .modal {
            background-color: white;
            padding: 2rem;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            animation: pop 0.3s ease-out;
            min-width: 300px;
        }

        .button-container {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin-top: 1rem;
        }

        @keyframes pop {
            0% { transform: scale(0.8); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }

        .modal h2 {
            color: #4CAF50;
            margin-top: 0;
        }

        .modal p {
            margin: 1rem 0;
        }
        
        .modal .close-button {
            position: absolute;
            top: 10px;
            right: 10px;
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #666;
        }
    </style>
</head>
<body>
    <div id="app">
        <div class="controls">
            <button @click="startNewGame">New Game</button>
            <button @click="backToMenu">Back to Menu</button>
        </div>
        <div class="board" :style="boardStyle">
            <template v-for="(row, i) in state.regions">
                <div v-for="(cell, j) in row" 
                     :key="`${i}-${j}`"
                     class="cell"
                     :style="getCellStyle(i, j)"
                     @click="toggleMark(i, j)">
                    <span v-if="state.marks[i][j] === 1" class="mark-x">X</span>
                    <img v-if="state.marks[i][j] === 2" 
                         src="/static/black_queen_logo.png" 
                         alt="Queen" 
                         class="mark-queen">
                </div>
            </template>
        </div>

        <!-- Victory Modal -->
        <div v-if="showVictoryModal" class="modal-overlay" @click="hideModal">
            <div class="modal" @click.stop>
                <h2>ðŸŽ‰ Congratulations! ðŸŽ‰</h2>
                <p>You've found all the queens!</p>
                <div class="button-container">
                    <button @click="startNewGame">New Game</button>
                    <button @click="hideModal">Continue Viewing</button>
                    <button @click="backToMenu">Back to Menu</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        const { createApp } = Vue;
        
        const app = createApp({
            data() {
                return {
                    state: {
                        regions: [],
                        marks: [],
                        size: 8
                    },
                    showVictoryModal: false,
                    colors: [
                        '#FF0000', // Red
                        '#00FF00', // Lime
                        '#0000FF', // Blue
                        '#FFD700', // Gold
                        '#FF00FF', // Magenta
                        '#00FFFF', // Cyan
                        '#FF8C00', // Dark Orange
                        '#8B4513', // Saddle Brown
                        '#98FF98', // Mint Green
                        '#32CD32', // Lime Green
                        '#FF69B4', // Hot Pink
                        '#8A2BE2', // Blue Violet
                        '#00CED1', // Dark Turquoise
                        '#FF4500', // Orange Red
                        '#2E8B57'  // Sea Green
                    ]
                }
            },
            computed: {
                boardStyle() {
                    return {
                        'grid-template-columns': `repeat(${this.state.size}, 60px)`
                    }
                }
            },
            methods: {
                getCellStyle(i, j) {
                    return {
                        backgroundColor: this.colors[this.state.regions[i][j]]
                    }
                },
                async toggleMark(i, j) {
                    const response = await fetch(`/api/toggle/${i}/${j}`);
                    const data = await response.json();
                    this.state.marks[i][j] = data.mark;
                    this.checkVictory();
                },
                async loadState() {
                    const response = await fetch('/api/state');
                    if (response.ok) {
                        this.state = await response.json();
                    } else {
                        window.location.href = '/';
                    }
                },
                checkVictory() {
                    // Count queens in each region
                    const regionQueens = new Array(this.state.size).fill(0);
                    for (let i = 0; i < this.state.size; i++) {
                        for (let j = 0; j < this.state.size; j++) {
                            if (this.state.marks[i][j] === 2) { // if queen
                                regionQueens[this.state.regions[i][j]]++;
                            }
                        }
                    }
                    // Check if each region has exactly one queen
                    if (regionQueens.every(count => count === 1)) {
                        this.showVictoryModal = true;
                    }
                },
                hideModal() {
                    this.showVictoryModal = false;
                },
                async startNewGame() {
                    const response = await fetch(`/api/new_game/${this.state.size}`);
                    if (response.ok) {
                        this.showVictoryModal = false;
                        this.state = await response.json();
                    }
                },
                backToMenu() {
                    window.location.href = '/';
                }
            },
            mounted() {
                this.loadState();
            }
        });

        app.mount('#app');
    </script>
</body>
</html>